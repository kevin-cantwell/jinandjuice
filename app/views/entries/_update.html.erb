<%= form_for @entry_form do |f| %>
  <p>
    <%= f.label :name, "Your name:" %>
    <%= f.text_field :name, title: "*required" %>
  </p>
  <p>
    <%= f.label :email, "Your email:" %>
    <%= f.text_field :email, title: "*required" %>
  </p>
  <h1>Leave a Message</h1>
  <p>
    <%= f.text_area :message, title: "I met Amy..." %>
  </p>
  <h1>Upload a Photo</h1>
  <p>
    <%= f.label :photo_url %>
    <%= f.text_field :photo_url %>
  </p>
  <p>
    <%= f.label :photo_attachment, "Upload" %>
    <%= f.file_field :photo_attachment %>
  </p>
  <% if @entry_form.photo_url %>
    <img src="<%= @entry_form.photo_url %>" />
  <% end %>
  <h1>Upload a Video</h1>
  <% if @entry_form.video? %>
    <% if @entry_form.video_ready? %>
      <video id="movie" width="<%= @entry_form.video_h264e.width %>" height="<%= @entry_form.video_h264e.height %>" preload="none" poster="<%= @entry_form.video_poster %>" controls>
        <source src="<%= @entry_form.video_h264e.url %>" type="video/mp4" />
        <source src="<%= @entry_form.video_ogg.url %>" type="video/ogg" />
      </video>
    <% else %>
       Your video is processing: <%= @entry_form.video_percent_complete %>%
    <% end %>
  <% end %>
  <!-- the control will appear next to this, and the video ID will be stored here after the upload -->
  <div class="file-input-container">
    <input type="hidden" name="entry_form[panda_video_id]" id="returned_video_id" />
  </div>
  <!-- upload progress bar (optional) -->
  <div id="upload_progress" class="panda_upload_progress"></div>
  <br/>
  <%= f.submit "Submit" %>
<% end %>

<style>
  .input-prompt {
    position: absolute;
    font-style: italic;
    color: #aaa;
    margin: 0.2em 0 0 0.5em;
  }
  .file-input-container {
    width: 270px;
    height: 480px;
    background-color: blue;
  }
  input[type="file"] {
    width: 200px;
    background: none;
  }
</style>

<script>
  <% auth_params = Panda.signed_params('post', "/videos.json") %>
  $("#returned_video_id").pandaUploader(<%=raw auth_params.to_json %>, {
    upload_progress_id: 'upload_progress'
  });
  $('input[type="submit"]').removeAttr('disabled');

  // For prompt text
  $(document).ready(function(){
    $('input[type=text][title],input[type=password][title],textarea[title]').each(function(i){
      $(this).addClass('input-prompt-' + i);
      var promptSpan = $('<span class="input-prompt"/>');
      $(promptSpan).attr('id', 'input-prompt-' + i);
      $(promptSpan).append($(this).attr('title'));
      $(promptSpan).click(function(){
        $(this).hide();
        $('.' + $(this).attr('id')).focus();
      });
      if($(this).val() != ''){
        $(promptSpan).hide();
      }
      $(this).before(promptSpan);
      $(this).focus(function(){
        $('#input-prompt-' + i).hide();
      });
      $(this).blur(function(){
        if($(this).val() == ''){
          $('#input-prompt-' + i).show().removeAttr('style');
        }
      });
    });
  });
</script>